# GitHub Star Crawler 设计文档

## 架构概述

本工具采用 GitHub 官方 API 作为数据源，确保合规性和可靠性。

## 技术架构

### 1. API 层
- **GitHub REST API**: 使用 `/repos/{owner}/{repo}/stargazers` 获取 star 用户列表
- **GraphQL API**: 可选，用于批量查询用户详细信息
- **认证机制**: 支持个人访问令牌 (Personal Access Token) 提高速率限制

### 2. 数据处理层
- **用户信息提取**: 从用户公开资料中获取邮箱信息
- **数据验证**: 过滤无效或私有邮箱
- **去重处理**: 移除重复的用户和邮箱

### 3. 输出层
- **CSV 导出**: 标准格式，便于数据分析
- **JSON 导出**: 结构化数据，便于程序处理
- **统计报告**: 提供基本的数据统计信息

## 速率限制策略

### GitHub API 限制
- **未认证请求**: 60 次/小时
- **认证请求**: 5000 次/小时
- **GraphQL**: 5000 点/小时

### 实现策略
1. **优先使用认证请求**: 通过环境变量配置 GitHub token
2. **请求间隔控制**: 在连续请求间添加适当延迟
3. **错误处理**: 处理 403 (速率限制) 和其他错误状态
4. **断点续传**: 支持从中断点继续执行

## 合规性考虑

### 数据来源合规
- 仅访问公开的 GitHub 仓库和用户信息
- 不绕过任何访问控制或隐私设置
- 遵守 GitHub 服务条款

### 数据使用合规
- 仅收集用户主动公开的邮箱信息
- 提供数据删除和导出机制
- 不用于垃圾邮件或其他滥用行为

## 错误处理和容错

### 网络错误
- 自动重试机制 (指数退避)
- 超时处理
- 网络状态检查

### API 错误
- 速率限制处理
- 认证失败处理
- 仓库不存在或私有处理

### 数据错误
- JSON 解析错误处理
- 数据格式验证
- 异常数据过滤

## 性能优化

### 并发控制
- 限制并发请求数量
- 智能请求队列管理
- 内存使用优化

### 缓存策略
- 用户信息缓存
- API 响应缓存
- 增量更新支持

## 安全考虑

### Token 管理
- 环境变量存储
- 不在代码中硬编码
- 支持多个 token 轮换

### 数据保护
- 敏感信息过滤
- 安全的文件输出权限
- 临时数据清理