## Context

魔兽世界游戏助手是一个专注于合规性和安全性的智能辅助系统。与传统的自动化机器人不同，我们的目标是提供辅助功能，帮助玩家提升游戏体验，同时严格遵守暴雪的用户条款，避免账号封禁风险。

项目需要在 Windows 平台运行，能够模拟人类操作模式，并提供可扩展的场景插件系统。

## Goals / Non-Goals

**Goals**:
- 创建合规的游戏辅助工具，不违反用户条款
- 实现人性化的输入模拟，避免被反作弊系统检测
- 提供可扩展的场景插件框架
- 确保用户始终掌控关键操作
- 建立完善的安全监控和防封机制

**Non-Goals**:
- 不实现全自动游戏操作机器人
- 不修改游戏客户端或内存
- 不提供无人值守的自动刷怪功能
- 不绕过游戏的反作弊系统

## Decisions

### 1. 技术栈选择

**Node.js + TypeScript**:
- 选择理由：快速开发、丰富的生态系统、跨平台支持
- 替代方案：Python (性能考虑)、C++ (复杂度过高)

**Windows API 输入模拟**:
- 选择理由：原生支持、不易检测、性能好
- 替代方案：robotjs (检测风险高)、硬件模拟 (成本高)

### 2. 架构模式

**插件化架构**:
```
Core System (核心安全框架)
├── Human Input Engine (人性化输入引擎)
├── Safety Monitor (安全监控)
├── AI Decision Engine (AI决策引擎)
└── Scenario Plugin Manager (场景插件管理器)

Scenario Plugins (场景插件)
├── Fishing Assistant (钓鱼助手)
├── Quest Helper (任务助手)
└── Inventory Manager (背包管理)
```

### 3. 输入模拟策略

**贝塞尔曲线鼠标轨迹**:
- 模拟真实的人类鼠标移动
- 随机速度变化和微调
- 基于距离和时间计算曲线

**动态延迟模型**:
- 基于人类反应时间的正态分布 (200-400ms)
- 考虑操作复杂度的延迟调整
- 添加"疲劳因子"影响反应速度

### 4. 安全机制

**多层防护体系**:
1. **输入层**: 人性化操作模拟
2. **行为层**: 操作随机化
3. **监控层**: 实时风险检测
4. **限制层**: 使用量控制

**防检测策略**:
- 操作时间随机化
- 模拟人类错误和纠正
- 定期"休息"模拟
- 行为模式多样化

## Risks / Trade-offs

### 技术风险

**Windows API 兼容性**:
- 风险：不同 Windows 版本的 API 差异
- 缓解：使用广泛的、稳定的 API 函数

**性能影响**:
- 风险：输入模拟可能影响系统性能
- 缓解：异步处理、资源池化

### 合规风险

**用户条款变更**:
- 风险：暴宝政策变化导致当前实现不合规
- 缓解：持续监控条款变化、模块化设计便于调整

**反作弊系统升级**:
- 风险：Warden 系统可能识别我们的行为模式
- 缓解：行为分析学习、快速响应机制

### 用户体验权衡

**安全性 vs 便利性**:
- 更多安全检查可能影响使用便利性
- 找到平衡点，关键操作确认，辅助操作自动化

**稳定性 vs 灵活性**:
- 严格的防封机制限制了某些自动化功能
- 通过插件系统提供不同级别的自动化选择

## Migration Plan

### 阶段 1: 核心框架 (2-3周)
- 建立基础项目结构
- 实现核心安全框架
- 开发人性化输入引擎
- 创建基本的安全监控

### 阶段 2: 首个场景 (2-3周)
- 开发钓鱼辅助场景
- 集成 AI 决策引擎
- 完善用户界面
- 进行安全测试

### 阶段 3: 扩展和优化 (持续)
- 添加更多场景插件
- 优化性能和稳定性
- 增强防检测能力
- 收集用户反馈

## Open Questions

1. **AI 模型选择**: 使用本地模型还是云端 API？考虑延迟和隐私问题
2. **输入检测粒度**: 如何平衡安全检测的准确性和性能开销？
3. **插件分发**: 如何确保第三方插件的安全性？
4. **数据存储**: 用户使用数据是否需要存储？如何保护隐私？

## 安全设计原则

### 1. 最小权限原则
- 只请求必要的系统权限
- 不读取或修改其他进程内存
- 不进行网络攻击或破解活动

### 2. 透明性原则
- 用户清楚每个操作的用途
- 提供详细的操作日志
- 开源核心安全代码

### 3. 可控性原则
- 用户可以随时暂停或终止操作
- 关键操作需要明确确认
- 提供紧急停止按钮

### 4. 渐进式自动化
- 从完全手动到轻度辅助
- 用户可以控制自动化程度
- 避免突然的行为变化